<% layout('layouts/boilerplate') %>
<div class="container mt-5">
    <h1 class="mb-4">Search Courses</h1>
    <form id="search-form" class="form-inline my-2 my-lg-0" onsubmit="return false;">
        <div class="input-group" style="width: 100%;">
            <input class="form-control" type="search" placeholder="Search" aria-label="Search" id="search-input" name="q" style="width: 90%;">
        </div>
    </form>
    <div class="mt-2" id="autocomplete-results">
        <ul id="suggestions" class="list-group"></ul>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const searchInput = document.getElementById('search-input');
        const suggestionsList = document.getElementById('suggestions');

        searchInput.addEventListener('input', async () => {
            const query = searchInput.value;
            if (query.length < 2) {
                suggestionsList.innerHTML = '';
                return;
            }
            try {
                const response = await fetch(`/courses/search?q=${encodeURIComponent(query)}`);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const results = await response.json();
                console.log('Results:', results);

                suggestionsList.innerHTML = '';

                results.forEach(item => {
                    const li = document.createElement('li');
                    li.classList.add('list-group-item', 'suggestion-item');
                    li.textContent = item.title;
                    li.addEventListener('click', () => {
                        window.location.href = `/courses/${item._id}`;
                    });
                    suggestionsList.appendChild(li);
                });
            } catch (error) {
                console.error('Error fetching search results:', error);
            }
        });
    });
</script>

<% layout('layouts/boilerplate') %>
<% var additionalStylesheet = '/stylesheets/show.css'; %>
<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="mb-0"><%= course.title %> <%= course.course_level %></h1>
        <% if (currentUser && course.author.equals(currentUser._id)) { %>
        <div>
            <a href="/courses/<%= course._id %>/edit" class="btn-link">Edit</a>
            <form action="/courses/<%= course._id %>?_method=DELETE" method="POST" class="d-inline-block">
                <button class="btn btn-danger">Delete</button>
            </form>
        </div>
        <% } %>
    </div>

    <p class="lead mb-4"><%= course.description %></p>
    
    <div class="show-card mb-4">
        <div class="show-card-header">
            <h4>Course Information</h4>
        </div>
        <div class="show-card-body">
            <p><strong>Professor:</strong> <%= course.professor %></p>
            <p><strong>Credits:</strong> <%= course.credits %></p>
            <p><strong>Student Rating:</strong> <%= course.student_rating %></p>
            <p><strong>Course Level:</strong> <%= course.course_level %></p>
            <p><strong>Location:</strong> <%= course.location %></p>
        </div>
    </div>

    <div class="show-card mb-4">
        <div class="show-card-header">
            <h4>Time Slots</h4>
        </div>
        <div class="show-card-body">
            <% const days = course.times.map(time => time.day).join(', '); %>
            <% if (course.times.length > 0) { %>
                <p><strong>Days:</strong> <%= days %></p>
                <p><strong>Time:</strong> <%= course.times[0].start_time %> - <%= course.times[0].end_time %></p>
            <% } %>
        </div>
    </div>


    <% if (currentUser) { %>
    <div class="show-card mb-4">
        <div class="show-card-header">
            <h4>Add a Review</h4>
        </div>
        <div class="show-card-body">
            <form action="/courses/<%= course._id %>/reviews" method="POST">
                <div class="form-group">
                    <label for="rating">Rating</label>
                    <input type="number" id="rating" name="review[rating]" class="form-control" min="1" max="5">
                </div>
                <div class="form-group">
                    <label for="body">Review</label>
                    <textarea id="body" name="review[body]" class="form-control"></textarea>
                </div>
                <button class="btn btn-custom mt-3">Add Review</button>
            </form>
        </div>
    </div>
    <% } %>
    
    <h3>Reviews</h3>
    <ul class="list-group pb-4">
        <% course.reviews.forEach(review => { %>
        <li class="list-group-item">
            <p><strong>Rating:</strong> <%= review.rating %></p>
            <p><%= review.body %></p>
        </li>
        <% }) %>
    </ul>
</div>
